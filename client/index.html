<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Alles-in-einem Beispiel</title>
</head>
<body>
<h1>Client</h1>

<h2>Registrierung</h2>
<input id="rname" placeholder="Name">
<input id="rpass" type="password" placeholder="Passwort">
<button onclick="register()">Registrieren</button>
<pre id="regResult"></pre>

<h2>Login</h2>
<input id="lname" placeholder="Name">
<input id="lpass" type="password" placeholder="Passwort">
<button onclick="login()">Login</button>
<pre id="loginResult"></pre>

<h2>Aktionen</h2>
<button onclick="refresh()">Token erneuern</button>
<button onclick="getMessage()">Gesch√ºtzte Nachricht</button>
<pre id="msg"></pre>

<script>
let access = null;
let refreshToken = null;

function register() {
  fetch("/api/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: rname.value,
      password: rpass.value
    })
  }).then(r => r.json()).then(j => regResult.textContent = JSON.stringify(j, null, 2));
}

function login() {
  fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: lname.value,
      password: lpass.value
    })
  }).then(r => r.json()).then(j => {
    access = j.access;
    refreshToken = j.refresh;
    loginResult.textContent = JSON.stringify(j, null, 2);
  });
}

function refresh() {
  fetch("/api/refresh", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ refresh: refreshToken })
  }).then(r => r.json()).then(j => {
    access = j.access;
    refreshToken = j.refresh;
  });
}

function getMessage() {
  fetch("/api/message", {
    headers: { "Authorization": "Bearer " + access }
  }).then(r => r.json()).then(j => {
    msg.textContent = JSON.stringify(j, null, 2);
  });
}
</script>

</body>
</html>
